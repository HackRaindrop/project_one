<!DOCTYPE html>
<html lang="en">

<head>
    <title>Book API</title>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>

<script>
    document.addEventListener('DOMContentLoaded', () => {

        // Get elements
        const userForm = document.getElementById('getRequests');
        const urlField = document.getElementById('urlField');
        const content = document.getElementById('content');
        //const nameForm = document.getElementById('nameForm')

        content.innerHTML = '';

        userForm.addEventListener('submit', async (e) => {

            e.preventDefault();
            const url = urlField.value;

            try {

                const response = await fetch(url);
                const jsonResponse = await response.json();

                // Clear previous content
                content.innerHTML = '';

                if (url === '/getBooks') {
                    // Display books as cards
                    content.innerHTML = `<h2>Found ${jsonResponse.length} books:</h2>`;

                    // Create book cards
                    jsonResponse.forEach(book => {
                        content.innerHTML += `
                            <div class="book-card">
                                <h3>${book.title}</h3>
                                <p><strong>Author:</strong> ${book.author}</p>
                                <p><strong>Year:</strong> ${book.year}</p>
                                <p><strong>Pages:</strong> ${book.pages}</p>
                                <p><strong>Language:</strong> ${book.language}</p>
                                <p><strong>Country:</strong> ${book.country}</p>
                                ${book.genres ? `<p><strong>Genres:</strong> ${book.genres.join(', ')}</p>` : ''}
                            </div>
                        `;
                    });
                } else if (url === '/getAuthors') {

                    // Display authors
                    let authorsList = '<ul class="simple-list">';
                    jsonResponse.forEach(author => {
                        authorsList += `<li>${author}</li>`;
                    });
                    authorsList += '</ul>';
                    content.innerHTML = `<h2>All Authors (${jsonResponse.length}):</h2>${authorsList}`;
                } else if (url === '/getGenres') {

                    // Display genres
                    let genresList = '<ul class="simple-list">';
                    jsonResponse.forEach(genre => {
                        genresList += `<li>${genre}</li>`;
                    });
                    genresList += '</ul>';
                    content.innerHTML = `<h2>All Genres (${jsonResponse.length}):</h2>${genresList}`;
                } else if (url === '/getLanguages') {

                    // Display languages
                    let languagesList = '<ul class="simple-list">';
                    jsonResponse.forEach(language => {
                        languagesList += `<li>${language}</li>`;
                    });
                    languagesList += '</ul>';
                    content.innerHTML = `<h2>All Languages (${jsonResponse.length}):</h2>${languagesList}`;
                }
            } catch (error) {
                content.textContent = `${error.message}`;
            }
        });

        // Event listener for new user form
        nameForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            // Get form data
            const formData = {
                title: document.getElementById('bookTitle').value,
                author: document.getElementById('bookAuthor').value,
            };
            try {

                // Make fetch request
                const response = await fetch('/addBook', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData),
                });

                // Handle 201 and 204 responses
                if (response.status === 201 || response.status === 204) {
                    const statusText = response.status === 201 ? 'Created' : 'Updated (No Content)';

                    // Show message for 201 response
                    if (response.status === 201) {
                        const jsonResponse = await response.json();
                        console.log(jsonResponse);
                        content.innerHTML = `<b>${statusText}</b><br>Message: ${jsonResponse.message}`;
                    } else {

                        // Show message for 204 response
                        content.innerHTML = `<b>${statusText}</b>`;
                    }
                } else {

                    // Show message for other responses
                    const jsonResponse = await response.json();
                    console.log(jsonResponse);
                    const statusText = response.status === 200 ? 'Success' : response.statusText;
                    content.innerHTML = `<b>${statusText}</b><br>Message: ${jsonResponse.message}`;
                }
            } catch (error) {
                content.textContent = `${error.message}`;
            }
        });
    });
</script>

<body>
    <section id="top">
        <h2>Book Search</h2>
        <form id="getRequests" action="/getBooks" method="get">
            <select id="urlField">
                <option value="/getBooks">/getBooks</option>
                <option value="/getAuthors">/getAuthors</option>
                <option value="/getGenres">/getGenres</option>
                <option value="/getLanguages">/getLanguages</option>
            </select>
            <input type="submit" value="Get Books">
        </form>
        <br>
        <h2>Add A Book</h2>
        <form id="postRequests" action="/addBook" method="post">
            <label for="title">Title: </label>
            <input id="bookTitle" type="text" name="title">
            <label for="author">Author: </label>
            <input id="bookAuthor" type="text" name="author">
            <input type="submit" value="Add Book">
        </form>
        <section id="content"></section>
    </section>
</body>

</html>